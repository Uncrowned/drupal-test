с помощью drush получаем список модулей, командой drush pml --pipe, далее для каждой строки вывода выполняем drush pmi %name --pipe --fields=project --format=csv, если ответ не пустой, то модуль контрибный, добавляем запись в нужную xml, если пустой, то кастомный.
